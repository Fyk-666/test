<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章专栏 - 班级网站</title>
    <!-- 必须引入 FontAwesome 图标库，否则专栏图标不显示 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/style.css">
    <style>
        /* --- 全局样式 --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            display: flex;
            flex-direction: column;
        }

        .container { width: 95%; max-width: 1200px; margin: 0 auto; padding-bottom: 50px; position: relative; z-index: 1; }
        
        .header-title { 
            text-align: center; font-size: 3rem; font-weight: bold; 
            letter-spacing: 5px; margin: 60px 0 40px; 
            text-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* --- 顶部按钮 --- */
        .action-bar { display: flex; justify-content: center; gap: 30px; margin-bottom: 50px; }
        
        .btn { 
            padding: 12px 35px; font-size: 1.1rem; font-weight: bold; 
            border-radius: 15px; cursor: pointer; text-decoration: none; 
            transition: all 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: white; color: #764ba2; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-glass { background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.4); backdrop-filter: blur(10px); }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }

        /* --- 专栏布局样式 --- */
        .category-section {
            margin-bottom: 50px;
            animation: fadeIn 0.6s ease;
        }

        /* 专栏标题 */
        .category-title {
            font-size: 1.6rem;
            font-weight: bold;
            color: white;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(90deg, rgba(255,255,255,0.15) 0%, transparent 100%);
            padding: 12px 20px;
            border-radius: 0 20px 20px 0;
            border-left: 6px solid #fff; /* 颜色由 JS 动态修改 */
            backdrop-filter: blur(5px);
        }

        .article-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 25px; 
        }

        /* --- 文章卡片 --- */
        .article-card {
            display: block; text-decoration: none; color: white;
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(12px);
            border-radius: 16px; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px; 
            height: 220px; 
            display: flex; flex-direction: column; justify-content: space-between;
            transition: 0.3s; position: relative;
            overflow: hidden;
        }

        .article-card:hover { 
            transform: translateY(-5px); 
            background: rgba(255, 255, 255, 0.18); 
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .status-badge {
            position: absolute; top: 15px; right: 15px;
            font-size: 0.75rem; padding: 4px 10px; border-radius: 10px;
            background: rgba(46, 204, 113, 0.25); border: 1px solid rgba(46, 204, 113, 0.5); color: #d4edda;
        }

        .card-title { 
            font-size: 1.3rem; font-weight: bold; margin-top: 15px;
            display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }

        .card-meta { 
            display: flex; justify-content: space-between; font-size: 0.85rem; opacity: 0.8; margin-top: 10px;
        }

        .card-divider { height: 1px; background: rgba(255,255,255,0.2); margin: 15px 0; }

        /* 卡片内的标签小丸子 */
        .card-tags { display: flex; gap: 8px; flex-wrap: wrap; margin-top: auto; }
        .tag-pill {
            font-size: 0.75rem; background: rgba(0, 0, 0, 0.2); 
            padding: 3px 10px; border-radius: 12px; color: #dfe6e9;
        }

        #loading { text-align: center; font-size: 1.2rem; margin-top: 50px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <!-- 导航栏 -->
    <nav>
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>班级网站</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">首页</a></li>
                <li><a href="article_list.html" class="active">班级公告</a></li>
                <li><a href="toolbox.html">工具箱</a></li>
                <li><a href="article.html">发文章</a></li>
                <li><a href="#">班级相册</a></li>
            </ul>
            <div class="user-section">
                <div class="user-info">
                    <span class="user-display-name" id="usernameDisplay"></span>
                    <span class="welcome-message" id="welcomeMessage"></span>
                </div>
                <div class="user-actions">
                    <a href="login.html" class="btn login-btn" id="loginBtn">登录</a>
                    <a href="register.html" class="btn register-btn" id="registerBtn">注册</a>
                    <a href="#" class="btn logout-btn" id="logoutBtn" style="display: none;">退出</a>
                </div>
            </div>
            <button class="mobile-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <div class="container">
        <h1 class="header-title">文章专栏</h1>

        <div class="action-bar">
            <a href="#" id="publishBtn" class="btn btn-primary"><i class="fas fa-pen"></i> 发布文章</a>
            <a href="#" id="myArticlesBtn" class="btn btn-glass"><i class="fas fa-user"></i> 我的文章</a>
        </div>

        <div id="loading"><i class="fas fa-spinner fa-spin"></i> 正在加载精彩内容...</div>
        
        <!-- 专栏容器：JS 会把文章按分类填入这里 -->
        <div id="columns-container"></div>
    </div>

    <!-- 页脚 -->
    <footer>
        <div class="container footer-container">
            <div class="footer-info">
                <h3><i class="fas fa-graduation-cap"></i> 班级网站</h3>
                <p>凝聚班级力量，记录成长点滴，共创美好未来</p>
                <div class="social-icons">
                    <a href="https://space.bilibili.com/3546617818909179"><i class="fab fa-bilibili"></i></a>
                    <a href="https://github.com/jiugulixiaoniu/Class-website"><i class="fab fa-github"></i></a>
                </div>
            </div>

            <div class="footer-links">
                <h4>快速链接</h4>
                <ul>
                    <li><a href="index.html">首页</a></li>
                    <li><a href="article_list.html">班级公告</a></li>
                    <li><a href="toolbox.html">工具箱</a></li>
                    <li><a href="article.html">发文章</a></li>
                    <li><a href="#">班级相册</a></li>
                </ul>
            </div>

            <div class="footer-contact">
                <h4>联系我们</h4>
                <ul>
                    <li><i class="fas fa-envelope"></i> none</li>
                    <li><i class="fas fa-phone"></i> none</li>
                    <li><i class="fas fa-map-marker-alt"></i> 常熟市昆承中学</li>
                </ul>
            </div>
        </div>

        <div class="copyright">
            <p>&copy; 2023 JGL Studio. 保留所有权利</p>
        </div>
    </footer>

    <script src="static/js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. 基础配置 ---
            const publishBtn = document.getElementById('publishBtn');
            const myArticlesBtn = document.getElementById('myArticlesBtn');
            
            // 智能识别当前路径 (GitHub Pages 兼容)
            const prefix = window.location.pathname.includes('/test/') ? '/test' : '';
            
            if (publishBtn) publishBtn.href = prefix + '/article'; 
            if (myArticlesBtn) myArticlesBtn.href = prefix + '/my_articles'; 
            
            // --- 2. 专栏配置 (Tag -> 专栏映射) ---
            // tag: 必须与你发布时的标签一致
            // icon: FontAwesome 图标代码
            // color: 标题左侧边框颜色
            const COLUMN_CONFIG = [
                { tag: '学习笔记', icon: 'fa-book-open', color: '#ff7675' },
                { tag: '生活碎片', icon: 'fa-coffee', color: '#55efc4' },
                { tag: '技术分享', icon: 'fa-code', color: '#74b9ff' },
                { tag: '校园活动', icon: 'fa-running', color: '#a29bfe' },
                { tag: '计划总结', icon: 'fa-clipboard-list', color: '#fdcb6e' },
                { tag: '随笔感悟', icon: 'fa-pen-fancy', color: '#fab1a0' },
                { tag: '其他', icon: 'fa-layer-group', color: '#dfe6e9' } // 兜底分类
            ];

            const GITHUB_PAGE_BASE = "https://fyk-666.github.io/test/static/articles/html/";
            // 核心 API：获取所有已发布的文章
            const API_URL = "https://kczx.pythonanywhere.com/api/articles?page_size=100&status=published";

            // --- 3. 加载与渲染逻辑 ---
            async function loadArticles() {
                const container = document.getElementById('columns-container');
                const loading = document.getElementById('loading');

                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    loading.style.display = 'none';

                    if (!data.articles || data.articles.length === 0) {
                        container.innerHTML = '<div style="text-align:center;color:rgba(255,255,255,0.7);">暂无已发布的文章</div>';
                        return;
                    }

                    // --- 数据分组逻辑 ---
                    const groups = {};
                    // 初始化每个桶
                    COLUMN_CONFIG.forEach(col => { groups[col.tag] = []; });

                    // 遍历文章，分配到桶里
                    data.articles.forEach(article => {
                        let placed = false;
                        
                        if (article.tags) {
                            // 拆分标签字符串 "学习,笔记" -> ['学习', '笔记']
                            const articleTags = article.tags.split(',').map(t => t.trim());
                            
                            // 按配置顺序匹配，一篇文章只归入一个主要专栏
                            for (const config of COLUMN_CONFIG) {
                                if (config.tag !== '其他' && articleTags.includes(config.tag)) {
                                    groups[config.tag].push(article);
                                    placed = true;
                                    break; 
                                }
                            }
                        }

                        // 没标签或标签不匹配配置的，放入"其他"
                        if (!placed) {
                            groups['其他'].push(article);
                        }
                    });

                    // --- 渲染 DOM ---
                    container.innerHTML = ''; // 清空

                    COLUMN_CONFIG.forEach(config => {
                        const articlesInGroup = groups[config.tag];

                        // 只有当该专栏有文章时才显示
                        if (articlesInGroup.length > 0) {
                            const section = document.createElement('div');
                            section.className = 'category-section';

                            // 生成卡片 HTML
                            const cardsHtml = articlesInGroup.map(article => `
                                <a href="${GITHUB_PAGE_BASE}${article.id}.html" target="_blank" class="article-card">
                                    <div class="status-badge">已发布</div>
                                    <div class="card-title">${article.title}</div>
                                    <div class="card-meta">
                                        <span><i class="far fa-user"></i> ${article.author}</span>
                                        <span>${new Date(article.created_at).toLocaleDateString()}</span>
                                    </div>
                                    <div class="card-divider"></div>
                                    <div class="card-tags">
                                        ${article.tags ? article.tags.split(',').map(t => 
                                            `<span class="tag-pill">#${t}</span>`
                                        ).join('') : ''}
                                    </div>
                                </a>
                            `).join('');

                            // 生成专栏标题和网格
                            section.innerHTML = `
                                <h2 class="category-title" style="border-left-color: ${config.color}">
                                    <i class="fas ${config.icon}"></i> ${config.tag}
                                </h2>
                                <div class="article-grid">
                                    ${cardsHtml}
                                </div>
                            `;

                            container.appendChild(section);
                        }
                    });

                } catch (error) {
                    console.error('Error:', error);
                    loading.innerHTML = '<i class="fas fa-exclamation-triangle"></i> 加载失败，请检查网络连接';
                }
            }

            // 启动加载
            loadArticles();
        });
    </script>
</body>
</html>
